<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta property="og:title" content="Part 13 - S&#39;équiper" />
<meta property="og:description" content="Pour la dernière partie de notre tutoriel nous allons ajouter de l&rsquo;équipement. L&rsquo;équipement est un genre d&rsquo;objet qui le joueur peut porter pour améliorer ses statistiques. De toute évidence cela peut-être plus complexe, selon le jeu, mais je vous laisse le soin de l&rsquo;implémenter selon vos besoins. Pour ce tutoriel, équiper une arme améliore la puissance d&rsquo;attaque et équiper un bouclier améliore la défense.
Vous l&rsquo;avez peut-être deviné, nous avons besoin d&rsquo;un nouveau composant qui nous indique quels objets sont équipables et quels effets ils procurent." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/tutoriels/tcod/part-13/" />
<meta property="article:published_time" content="2019-03-30T09:34:10-07:00"/>
<meta property="article:modified_time" content="2019-03-30T09:34:10-07:00"/>

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Part 13 - S&#39;équiper"/>
<meta name="twitter:description" content="Pour la dernière partie de notre tutoriel nous allons ajouter de l&rsquo;équipement. L&rsquo;équipement est un genre d&rsquo;objet qui le joueur peut porter pour améliorer ses statistiques. De toute évidence cela peut-être plus complexe, selon le jeu, mais je vous laisse le soin de l&rsquo;implémenter selon vos besoins. Pour ce tutoriel, équiper une arme améliore la puissance d&rsquo;attaque et équiper un bouclier améliore la défense.
Vous l&rsquo;avez peut-être deviné, nous avons besoin d&rsquo;un nouveau composant qui nous indique quels objets sont équipables et quels effets ils procurent."/>



    <link rel="canonical" href="/tutoriels/tcod/part-13/">

    <title>
      
        Part 13 - S&#39;équiper | Tutoriel Roguelike
      
    </title>

    
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link href="/css/style.css" rel="stylesheet">

    

    

    
  </head>
  <body>
    
      

<header class="blog-header">
    <nav class="navbar navbar-expand-md navbar-dark bg-dark">
        <a class="navbar-brand" href="/">
            Tutoriel Roguelike
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false"
            aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-between" id="navbarNav">
            <ul class="navbar-nav">
                
                
                <li class="nav-item ">
                    
                        <a class="nav-link" href="/">Home</a>
                    
                </li>
                
                <li class="nav-item ">
                    
                        <a class="nav-link" href="/tutoriels/tcod/">Tutoriel TCOD</a>
                    
                </li>
                
                <li class="nav-item ">
                    
                        <a class="nav-link" href="/about/">A propos</a>
                    
                </li>
                
            </ul>
            
        </div>
    </nav>
</header>

    

    
    <div class="container">
      <div class="row">
        <div class="col-12 col-lg-8 blog-main">

          

<header>
    <h2 class="blog-post-title">
    <a class="text-dark" href="/tutoriels/tcod/part-13/">Part 13 - S&rsquo;équiper</a>
</h2>

    


<div class="blog-post-date text-secondary">
    
        <time datetime="2019-03-30">Mar 30, 2019</time>
    
    
</div>

    
    
    <hr>
</header>
<article class="blog-post">
    <p>Pour la dernière partie de notre tutoriel nous allons ajouter de l&rsquo;équipement.
L&rsquo;équipement est un genre d&rsquo;objet qui le joueur peut porter pour améliorer ses
statistiques. De toute évidence cela peut-être plus complexe, selon le jeu, mais
je vous laisse le soin de l&rsquo;implémenter selon vos besoins. Pour ce tutoriel,
équiper une arme améliore la puissance d&rsquo;attaque et équiper un bouclier
améliore la défense.</p>

<p>Vous l&rsquo;avez peut-être deviné, nous avons besoin d&rsquo;un nouveau composant qui
nous indique quels objets sont équipables et quels effets ils procurent.
Ce composant s&rsquo;appelera <code>Equippable</code> et nous l&rsquo;incluerons à un fichier
appelé <code>equippable.py</code> qui ira dans le dossier <code>components</code>.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Equippable</span>:
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self, slot, power_bonus<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, defense_bonus<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, max_hp_bonus<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>):
        self<span style="color:#f92672">.</span>slot <span style="color:#f92672">=</span> slot
        self<span style="color:#f92672">.</span>power_bonus <span style="color:#f92672">=</span> power_bonus
        self<span style="color:#f92672">.</span>defense_bonus <span style="color:#f92672">=</span> defense_bonus
        self<span style="color:#f92672">.</span>max_hp_bonus <span style="color:#f92672">=</span> max_hp_bonus</code></pre></div>

<p><code>power_bonus</code>, <code>defense_bonus</code> et <code>max_hp_bonus</code> sont les gains que le joueur
obtient en portant certains objets. Une arme donne un bonus d&rsquo;attaque et un
boucle donne un bonus de défense. Nous n&rsquo;inclurons aucun objet donnant un
de points de vie mais vous pouvez ajouter une armure ou une bague qui améliore
la santé.</p>

<p>Qu&rsquo;est-ce que <code>slot</code> ? Cela décrit l&rsquo;endroit où sera porté l&rsquo;objet. Le joueur
aura deux emplacements différents disponibles : la main principale pour l&rsquo;arme
et la main secondaire pour le bouclier. Nous implémenterons ça à l&rsquo;aide d&rsquo;un
<code>enum</code>. Créez un fichier appelé <code>equipment_slots.py</code> dans le dossier de base
et ajoutez-y :</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3"><span style="color:#f92672">from</span> enum <span style="color:#66d9ef">import</span> Enum


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">EquipmentSlots</span>(Enum):
    MAIN_HAND <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    OFF_HAND <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span></code></pre></div>

<p>Vous pouvez étendre ça autant que vous le souhaitez en donnant au joueur
des emplacements comme la tête, le corps, les jambes et les doigts.</p>

<p>On a maintenant ce qu&rsquo;il nous faut pour rendre les objets équipables. Mais
que va-t-on porter ? Pour ça il nous faut un autre composant appelé <code>Equipment</code>.
Ajoutez la suite à un nouveau fichier du dossier <code>components</code> appelé
<code>equipment.py</code> :</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3"><span style="color:#f92672">from</span> equipment_slots <span style="color:#66d9ef">import</span> EquipmentSlots


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Equipment</span>:
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self, main_hand<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, off_hand<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>):
        self<span style="color:#f92672">.</span>main_hand <span style="color:#f92672">=</span> main_hand
        self<span style="color:#f92672">.</span>off_hand <span style="color:#f92672">=</span> off_hand

    <span style="color:#a6e22e">@property</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">max_hp_bonus</span>(self):
        bonus <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>

        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>main_hand <span style="color:#f92672">and</span> self<span style="color:#f92672">.</span>main_hand<span style="color:#f92672">.</span>equippable:
            bonus <span style="color:#f92672">+=</span> self<span style="color:#f92672">.</span>main_hand<span style="color:#f92672">.</span>equippable<span style="color:#f92672">.</span>max_hp_bonus

        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>off_hand <span style="color:#f92672">and</span> self<span style="color:#f92672">.</span>off_hand<span style="color:#f92672">.</span>equippable:
            bonus <span style="color:#f92672">+=</span> self<span style="color:#f92672">.</span>off_hand<span style="color:#f92672">.</span>equippable<span style="color:#f92672">.</span>max_hp_bonus

        <span style="color:#66d9ef">return</span> bonus

    <span style="color:#a6e22e">@property</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">power_bonus</span>(self):
        bonus <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>

        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>main_hand <span style="color:#f92672">and</span> self<span style="color:#f92672">.</span>main_hand<span style="color:#f92672">.</span>equippable:
            bonus <span style="color:#f92672">+=</span> self<span style="color:#f92672">.</span>main_hand<span style="color:#f92672">.</span>equippable<span style="color:#f92672">.</span>power_bonus

        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>off_hand <span style="color:#f92672">and</span> self<span style="color:#f92672">.</span>off_hand<span style="color:#f92672">.</span>equippable:
            bonus <span style="color:#f92672">+=</span> self<span style="color:#f92672">.</span>off_hand<span style="color:#f92672">.</span>equippable<span style="color:#f92672">.</span>power_bonus

        <span style="color:#66d9ef">return</span> bonus

    <span style="color:#a6e22e">@property</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">defense_bonus</span>(self):
        bonus <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>

        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>main_hand <span style="color:#f92672">and</span> self<span style="color:#f92672">.</span>main_hand<span style="color:#f92672">.</span>equippable:
            bonus <span style="color:#f92672">+=</span> self<span style="color:#f92672">.</span>main_hand<span style="color:#f92672">.</span>equippable<span style="color:#f92672">.</span>defense_bonus

        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>off_hand <span style="color:#f92672">and</span> self<span style="color:#f92672">.</span>off_hand<span style="color:#f92672">.</span>equippable:
            bonus <span style="color:#f92672">+=</span> self<span style="color:#f92672">.</span>off_hand<span style="color:#f92672">.</span>equippable<span style="color:#f92672">.</span>defense_bonus

        <span style="color:#66d9ef">return</span> bonus

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">toggle_equip</span>(self, equippable_entity):
        results <span style="color:#f92672">=</span> []

        slot <span style="color:#f92672">=</span> equippable_entity<span style="color:#f92672">.</span>equippable<span style="color:#f92672">.</span>slot

        <span style="color:#66d9ef">if</span> slot <span style="color:#f92672">==</span> EquipmentSlots<span style="color:#f92672">.</span>MAIN_HAND:
            <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>main_hand <span style="color:#f92672">==</span> equippable_entity:
                self<span style="color:#f92672">.</span>main_hand <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
                results<span style="color:#f92672">.</span>append({<span style="color:#e6db74">&#39;dequipped&#39;</span>: equippable_entity})
            <span style="color:#66d9ef">else</span>:
                <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>main_hand:
                    results<span style="color:#f92672">.</span>append({<span style="color:#e6db74">&#39;dequipped&#39;</span>: self<span style="color:#f92672">.</span>main_hand})

                self<span style="color:#f92672">.</span>main_hand <span style="color:#f92672">=</span> equippable_entity
                results<span style="color:#f92672">.</span>append({<span style="color:#e6db74">&#39;equipped&#39;</span>: equippable_entity})
        <span style="color:#66d9ef">elif</span> slot <span style="color:#f92672">==</span> EquipmentSlots<span style="color:#f92672">.</span>OFF_HAND:
            <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>off_hand <span style="color:#f92672">==</span> equippable_entity:
                self<span style="color:#f92672">.</span>off_hand <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
                results<span style="color:#f92672">.</span>append({<span style="color:#e6db74">&#39;dequipped&#39;</span>: equippable_entity})
            <span style="color:#66d9ef">else</span>:
                <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>off_hand:
                    results<span style="color:#f92672">.</span>append({<span style="color:#e6db74">&#39;dequipped&#39;</span>: self<span style="color:#f92672">.</span>off_hand})

                self<span style="color:#f92672">.</span>off_hand <span style="color:#f92672">=</span> equippable_entity
                results<span style="color:#f92672">.</span>append({<span style="color:#e6db74">&#39;equipped&#39;</span>: equippable_entity})

        <span style="color:#66d9ef">return</span> results</code></pre></div>

<p>Cela fait beaucoup de code d&rsquo;un coup aussi nous allons le découper un peu.</p>

<p>Les deux variables <code>main_hand</code> et <code>off_hand</code> vont contenir les entités qui
sont équipées. Si elles pointes vers <code>None</code>, cela signifie que rien n&rsquo;est
porté dans cet emplacement.</p>

<p>Les trois propriétés font toutes sensiblement la même chose : elles ajoutent
les &ldquo;bonus&rdquo; de la main principale et de la main secondaire et renvoie la valeur.
Comme nous employons des propriétés on peut y accéder comme à une variable
ce qui sera rapidement commode. Si le joueur porte un objet en main principale
et en main secondaire qui améliore l&rsquo;attaque, par exemple, on récupère le bonus
de la même manière.</p>

<p><code>toggle_equip</code> (basculer l&rsquo;équipement) est ce qu&rsquo;on appelle quand on met
ou qu&rsquo;on enlève un objet dans l&rsquo;emplacement. Si l&rsquo;objet n&rsquo;était pas déjà
porté, on l&rsquo;équipe et s&rsquo;il était déjà équipé on l&rsquo;enlève. On renvoie le
résultat de cette opération comme précédemment et c&rsquo;est <code>engine</code> qui va
se charger de la suite du procédé.</p>

<p>Comme pour les autres composants crées, nous aurons besoin d&rsquo;ajouter ces
nouveaux à la classe <code>Entity</code>.</p>

<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

   <div class="data-pane active" data-pane="diff">
   <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">import tcod as libtcod

import math

<span style="color:#a6e22e">+from components.item import Item
</span><span style="color:#a6e22e"></span>
from render_functions import RenderOrder


class Entity:
    def __init__(self, x, y, char, color, name, blocks=False, render_order=RenderOrder.CORPSE, fighter=None, ai=None,
<span style="color:#f92672">-                item=None, inventory=None, stairs=None, level=None):
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+                item=None, inventory=None, stairs=None, level=None, equipment=None, equippable=None):
</span><span style="color:#a6e22e"></span>        self.x = x
        self.y = y
        self.char = char
        self.color = color
        self.name = name
        self.blocks = blocks
        self.render_order = render_order
        self.fighter = fighter
        self.ai = ai
        self.item = item
        self.inventory = inventory
        self.stairs = stairs
        self.level = level
<span style="color:#a6e22e">+       self.equipment = equipment
</span><span style="color:#a6e22e">+       self.equippable = equippable
</span><span style="color:#a6e22e"></span>
        if self.fighter:
            self.fighter.owner = self

        if self.ai:
            self.ai.owner = self

        if self.item:
            self.item.owner = self

        if self.inventory:
            self.inventory.owner = self

        if self.stairs:
            self.stairs.owner = self

        if self.level:
            self.level.owner = self

<span style="color:#a6e22e">+       if self.equipment:
</span><span style="color:#a6e22e">+           self.equipment.owner = self
</span><span style="color:#a6e22e">+
</span><span style="color:#a6e22e">+       if self.equippable:
</span><span style="color:#a6e22e">+           self.equippable.owner = self
</span><span style="color:#a6e22e">+
</span><span style="color:#a6e22e">+           if not self.item:
</span><span style="color:#a6e22e">+               item = Item()
</span><span style="color:#a6e22e">+               self.item = item
</span><span style="color:#a6e22e">+               self.item.owner = self
</span><span style="color:#a6e22e"></span>
    def move(self, dx, dy):
        ...
</code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>import tcod as libtcod

import math

<span class="new-text">from components.item import Item</span>

from render_functions import RenderOrder


class Entity:
    def __init__(self, x, y, char, color, name, blocks=False, render_order=RenderOrder.CORPSE, fighter=None, ai=None,
                 item=None, inventory=None, stairs=None, level=None<span class="new-text">, equipment=None, equippable=None</span>):
        self.x = x
        self.y = y
        self.char = char
        self.color = color
        self.name = name
        self.blocks = blocks
        self.render_order = render_order
        self.fighter = fighter
        self.ai = ai
        self.item = item
        self.inventory = inventory
        self.stairs = stairs
        self.level = level
        <span class="new-text">self.equipment = equipment
        self.equippable = equippable</span>

        if self.fighter:
            self.fighter.owner = self

        if self.ai:
            self.ai.owner = self

        if self.item:
            self.item.owner = self

        if self.inventory:
            self.inventory.owner = self

        if self.stairs:
            self.stairs.owner = self

        if self.level:
            self.level.owner = self

        <span class="new-text">if self.equipment:
            self.equipment.owner = self

        if self.equippable:
            self.equippable.owner = self

            if not self.item:
                item = Item()
                self.item = item
                self.item.owner = self</span>

    def move(self, dx, dy):
        ...</pre>

</div>

</div>


<p>Remarquez que si l&rsquo;entité n&rsquo;a pas de composant <code>Item</code> on lui en ajoute un.
Cela s&rsquo;explique car chaque pièce d&rsquo;équipement est aussi un objet qu&rsquo;on ajoute
à l&rsquo;inventaire, ramasse et dépose.</p>

<p>Ajoutons un nouveau composant <code>Equipment</code> au joueur dans
<code>initialize_new_game.py</code> :</p>

<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

   <div class="data-pane active" data-pane="diff">
   <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">    ...
    level_component = Level()
<span style="color:#a6e22e">+   equipment_component = Equipment()
</span><span style="color:#a6e22e"></span><span style="color:#f92672">-   player = Entity(0, 0, &#39;@&#39;, libtcod.white, &#39;Player&#39;, blocks=True, render_order=RenderOrder.ACTOR,
</span><span style="color:#f92672">-                   fighter=fighter_component, inventory=inventory_component, level=level_component)
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+   player = Entity(0, 0, &#39;@&#39;, libtcod.white, &#39;Player&#39;, blocks=True, render_order=RenderOrder.ACTOR,
</span><span style="color:#a6e22e">+                   fighter=fighter_component, inventory=inventory_component, level=level_component,
</span><span style="color:#a6e22e">+                   equipment=equipment_component)
</span><span style="color:#a6e22e"></span>    entities = [player]
    ...
</code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>    ...
    level_component = Level()
    <span class="new-text">equipment_component = Equipment()</span>
    <span class="crossed-out-text">player = Entity(0, 0, '@', libtcod.white, 'Player', blocks=True, render_order=RenderOrder.ACTOR,</span>
                    <span class="crossed-out-text">fighter=fighter_component, inventory=inventory_component, level=level_component)</span>
    <span class="new-text">player = Entity(0, 0, '@', libtcod.white, 'Player', blocks=True, render_order=RenderOrder.ACTOR,
                    fighter=fighter_component, inventory=inventory_component, level=level_component,
                    equipment=equipment_component)</span>
    entities = [player]
    ...</pre>

</div>

</div>


<p>Assurez-vous d&rsquo;importer le composant dans le fichier :</p>

<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

   <div class="data-pane active" data-pane="diff">
   <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">import tcod as libtcod

<span style="color:#a6e22e">+from components.equipment import Equipment
</span><span style="color:#a6e22e"></span>from components.fighter import Fighter
from components.inventory import Inventory
from components.level import Level
...
</code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>import tcod as libtcod

<span class="new-text">from components.equipment import Equipment</span>
from components.fighter import Fighter
from components.inventory import Inventory
from components.level import Level
...</pre>

</div>

</div>


<p>Aussi, comment le joueur procède-t-il pour porter un objet ? L&rsquo;équipement sera
sivible depuis l&rsquo;écran d&rsquo;inventaire comme n&rsquo;importe quel objet utilisable aussi
pourquoi ne pas étendre cette fonctionnalité ? Nous pouvons modifier la méthode
<code>use</code> de <code>Inventory</code> pour équiper un objet si c&rsquo;est possible :</p>

<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

   <div class="data-pane active" data-pane="diff">
   <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">        ...
        if item_component.use_function is None:
<span style="color:#f92672">-           results.append({&#39;message&#39;: Message(&#39;The {0} cannot be used&#39;.format(item_entity.name), libtcod.yellow)})
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+           equippable_component = item_entity.equippable
</span><span style="color:#a6e22e">+
</span><span style="color:#a6e22e">+           if equippable_component:
</span><span style="color:#a6e22e">+               results.append({&#39;equip&#39;: item_entity})
</span><span style="color:#a6e22e">+           else:
</span><span style="color:#a6e22e">+               results.append({&#39;message&#39;: Message(&#39;The {0} cannot be used&#39;.format(item_entity.name), libtcod.yellow)})
</span><span style="color:#a6e22e"></span>        else:
            ...
</code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>        ...
        if item_component.use_function is None:
            <span class="crossed-out-text">results.append({'message': Message('The {0} cannot be used'.format(item_entity.name), libtcod.yellow)})</span>
            <span class="new-text">equippable_component = item_entity.equippable

            if equippable_component:
                results.append({'equip': item_entity})
            else:
                results.append({'message': Message('The {0} cannot be used'.format(item_entity.name), libtcod.yellow)})</span>
        else:
            ...
</pre>

</div>

</div>


<p>Maintenant la méthode vérifie si l&rsquo;objet est équipable et, si c&rsquo;est le cas,
nous renvoyons le résultat. Sinon, nous affichons un avertissement nous
indiquant que c&rsquo;est impossible, comme d&rsquo;habitude.</p>

<p>Mettons la méthode <code>toggle_equip</code> en action. Dans <code>engine.py</code> :</p>

<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

   <div class="data-pane active" data-pane="diff">
   <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">            ...
            item_dropped = player_turn_result.get(&#39;item_dropped&#39;)
<span style="color:#a6e22e">+           equip = player_turn_result.get(&#39;equip&#39;)
</span><span style="color:#a6e22e"></span>            targeting = player_turn_result.get(&#39;targeting&#39;)
            ...
</code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>            ...
            item_dropped = player_turn_result.get('item_dropped')
            <span class="new-text">equip = player_turn_result.get('equip')</span>
            targeting = player_turn_result.get('targeting')
            ...</pre>

</div>

</div>


<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

   <div class="data-pane active" data-pane="diff">
   <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">            ...
            if item_dropped:
                entities.append(item_dropped)

                game_state = GameStates.ENEMY_TURN

<span style="color:#a6e22e">+           if equip:
</span><span style="color:#a6e22e">+               equip_results = player.equipment.toggle_equip(equip)
</span><span style="color:#a6e22e">+
</span><span style="color:#a6e22e">+               for equip_result in equip_results:
</span><span style="color:#a6e22e">+                   equipped = equip_result.get(&#39;equipped&#39;)
</span><span style="color:#a6e22e">+                   dequipped = equip_result.get(&#39;dequipped&#39;)
</span><span style="color:#a6e22e">+
</span><span style="color:#a6e22e">+                   if equipped:
</span><span style="color:#a6e22e">+                       message_log.add_message(Message(&#39;You equipped the {0}&#39;.format(equipped.name)))
</span><span style="color:#a6e22e">+
</span><span style="color:#a6e22e">+                   if dequipped:
</span><span style="color:#a6e22e">+                       message_log.add_message(Message(&#39;You dequipped the {0}&#39;.format(dequipped.name)))
</span><span style="color:#a6e22e">+
</span><span style="color:#a6e22e">+               game_state = GameStates.ENEMY_TURN
</span><span style="color:#a6e22e"></span>
            if targeting:
            ...
</code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>            ...
            if item_dropped:
                entities.append(item_dropped)

                game_state = GameStates.ENEMY_TURN

            <span class="new-text">if equip:
                equip_results = player.equipment.toggle_equip(equip)

                for equip_result in equip_results:
                    equipped = equip_result.get('equipped')
                    dequipped = equip_result.get('dequipped')

                    if equipped:
                        message_log.add_message(Message('You equipped the {0}'.format(equipped.name)))

                    if dequipped:
                        message_log.add_message(Message('You dequipped the {0}'.format(dequipped.name)))

                game_state = GameStates.ENEMY_TURN</span>

            if targeting:
            ...</pre>

</div>

</div>


<p>Il y a un petit bug dans notre implémentation. Le joueur peut déposer un objet
depuis l&rsquo;inventaire mais continuer à le porter sur lui ! Ce n&rsquo;est pas correct
aussi nous allons résoudre ce problème dans la méthode <code>drop_item</code> de
<code>Inventory</code> :</p>

<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

   <div class="data-pane active" data-pane="diff">
   <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">   ...
    def drop_item(self, item):
        results = []

<span style="color:#a6e22e">+       if self.owner.equipment.main_hand == item or self.owner.equipment.off_hand == item:
</span><span style="color:#a6e22e">+           self.owner.equipment.toggle_equip(item)
</span><span style="color:#a6e22e"></span>
        item.x = self.owner.x
        ...
</code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>   ...
    def drop_item(self, item):
        results = []

        <span class="new-text">if self.owner.equipment.main_hand == item or self.owner.equipment.off_hand == item:
            self.owner.equipment.toggle_equip(item)</span>

        item.x = self.owner.x
        ...</pre>

</div>

</div>


<p>Mais qu&rsquo;est ce qu&rsquo;équiper un objet <em>fait</em> réellement ? Cela <em>devrait</em> donner un
bonus au joueur mais cela ne fait rien pour l&rsquo;instant. Pourquoi ? Parce que
notre composant <code>FIghter</code> ne tient pas compte du bonus d&rsquo;équipement pour
l&rsquo;instant. Réglons ça :</p>

<p>Nous devons ajuster la manière d&rsquo;obtenir les valeurs de <code>Fighter</code>. Il serait
plus judicieux que <code>max_hp</code>, <code>power</code> et <code>defense</code> soient des propriétés
afin qu&rsquo;on puisse les calculer comme une base ajouté à un bonus.
Changeons la fonction d&rsquo;initialisation pour régler les bases de chacune de
ces valeurs et nous ajouterons les propriétés à chacun pour remplacer nos
anciennes variables.</p>

<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

   <div class="data-pane active" data-pane="diff">
   <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">class Fighter:
    def __init__(self, hp, defense, power, xp=0):
<span style="color:#f92672">-       self.max_hp = hp
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+       self.base_max_hp = hp
</span><span style="color:#a6e22e"></span>        self.hp = hp
<span style="color:#f92672">-       self.defense = defense
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+       self.base_defense = defense
</span><span style="color:#a6e22e"></span><span style="color:#f92672">-       self.power = power
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+       self.base_power = power
</span><span style="color:#a6e22e"></span>        self.xp = xp

<span style="color:#a6e22e">+   @property
</span><span style="color:#a6e22e">+   def max_hp(self):
</span><span style="color:#a6e22e">+       if self.owner and self.owner.equipment:
</span><span style="color:#a6e22e">+           bonus = self.owner.equipment.max_hp_bonus
</span><span style="color:#a6e22e">+       else:
</span><span style="color:#a6e22e">+           bonus = 0
</span><span style="color:#a6e22e">+
</span><span style="color:#a6e22e">+       return self.base_max_hp + bonus
</span><span style="color:#a6e22e">+
</span><span style="color:#a6e22e">+   @property
</span><span style="color:#a6e22e">+   def power(self):
</span><span style="color:#a6e22e">+       if self.owner and self.owner.equipment:
</span><span style="color:#a6e22e">+           bonus = self.owner.equipment.power_bonus
</span><span style="color:#a6e22e">+       else:
</span><span style="color:#a6e22e">+           bonus = 0
</span><span style="color:#a6e22e">+
</span><span style="color:#a6e22e">+       return self.base_power + bonus
</span><span style="color:#a6e22e">+
</span><span style="color:#a6e22e">+   @property
</span><span style="color:#a6e22e">+   def defense(self):
</span><span style="color:#a6e22e">+       if self.owner and self.owner.equipment:
</span><span style="color:#a6e22e">+           bonus = self.owner.equipment.defense_bonus
</span><span style="color:#a6e22e">+       else:
</span><span style="color:#a6e22e">+           bonus = 0
</span><span style="color:#a6e22e">+
</span><span style="color:#a6e22e">+       return self.base_defense + bonus
</span><span style="color:#a6e22e"></span>
    def take_damage(self, amount):
        ...
</code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>class Fighter:
    def __init__(self, hp, defense, power, xp=0):
        <span class="crossed-out-text">self.max_hp = hp</span>
        <span class="new-text">self.base_max_hp = hp</span>
        self.hp = hp
        <span class="crossed-out-text">self.defense = defense</span>
        <span class="new-text">self.base_defense = defense</span>
        <span class="crossed-out-text">self.power = power</span>
        <span class="new-text">self.base_power = power</span>
        self.xp = xp

    <span class="new-text">@property
    def max_hp(self):
        if self.owner and self.owner.equipment:
            bonus = self.owner.equipment.max_hp_bonus
        else:
            bonus = 0

        return self.base_max_hp + bonus

    @property
    def power(self):
        if self.owner and self.owner.equipment:
            bonus = self.owner.equipment.power_bonus
        else:
            bonus = 0

        return self.base_power + bonus

    @property
    def defense(self):
        if self.owner and self.owner.equipment:
            bonus = self.owner.equipment.defense_bonus
        else:
            bonus = 0

        return self.base_defense + bonus</span>

    def take_damage(self, amount):
        ...</pre>

</div>

</div>


<p>Ainsi maintenant quand nous nous relevons la valeur de <code>power</code>, par exemple,
nous prendrons en compte l&rsquo;équipement du joueur.</p>

<p>Dans la plupart des cas cela suffit. La seule chose qui pose encore problème
dans le code précédent est le gain d&rsquo;un niveau parce qu&rsquo;on nous augmentons
directement les valeurs de <code>max_hp</code>, <code>defense</code> et <code>power</code> alors qu&rsquo;on devrait
augmenter leurs valeurs de base. C&rsquo;est plutôt simple à résoudre, ouvrez
<code>engine.py</code> et apportez les modifications suivantes :</p>

<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

   <div class="data-pane active" data-pane="diff">
   <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">        ...
        if level_up:
            if level_up == &#39;hp&#39;:
<span style="color:#f92672">-               player.fighter.max_hp += 20
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+               player.fighter.base_max_hp += 20
</span><span style="color:#a6e22e"></span>                player.fighter.hp += 20
            elif level_up == &#39;str&#39;:
<span style="color:#f92672">-               player.fighter.power += 1
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+               player.fighter.base_power += 1
</span><span style="color:#a6e22e"></span>            elif level_up == &#39;def&#39;:
<span style="color:#f92672">-               player.fighter.defense += 1
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+               player.fighter.base_defense += 1
</span><span style="color:#a6e22e"></span>        ...
</code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>        ...
        if level_up:
            if level_up == 'hp':
                <span class="crossed-out-text">player.fighter.max_hp += 20</span>
                <span class="new-text">player.fighter.base_max_hp += 20</span>
                player.fighter.hp += 20
            elif level_up == 'str':
                <span class="crossed-out-text">player.fighter.power += 1</span>
                <span class="new-text">player.fighter.base_power += 1</span>
            elif level_up == 'def':
                <span class="crossed-out-text">player.fighter.defense += 1</span>
                <span class="new-text">player.fighter.base_defense += 1</span>
        ...</pre>

</div>

</div>


<p>Ceci étant en place, mettons de l&rsquo;équipement sur la carte ! Ouvrez
<code>game_map.py</code> et modifiez la fonction <code>place_entities</code> pour ajouter de
l&rsquo;équipement dans la donjon. Souvenvez-vous d&rsquo;importer les composants
nécessaire en haut.</p>

<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

   <div class="data-pane active" data-pane="diff">
   <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">...
from components.ai import BasicMonster
<span style="color:#a6e22e">+from components.equipment import EquipmentSlots
</span><span style="color:#a6e22e">+from components.equippable import Equippable
</span><span style="color:#a6e22e"></span>from components.fighter import Fighter
...
</code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>...
from components.ai import BasicMonster
<span class="new-text">from components.equipment import EquipmentSlots
from components.equippable import Equippable</span>
from components.fighter import Fighter
...</pre>

</div>

</div>


<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

   <div class="data-pane active" data-pane="diff">
   <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">       item_chances = {
            &#39;healing_potion&#39;: 35,
<span style="color:#a6e22e">+           &#39;sword&#39;: from_dungeon_level([[5, 4]], self.dungeon_level),
</span><span style="color:#a6e22e">+           &#39;shield&#39;: from_dungeon_level([[15, 8]], self.dungeon_level),
</span><span style="color:#a6e22e"></span>            &#39;lightning_scroll&#39;: from_dungeon_level([[25, 4]], self.dungeon_level),
            &#39;fireball_scroll&#39;: from_dungeon_level([[25, 6]], self.dungeon_level),
            &#39;confusion_scroll&#39;: from_dungeon_level([[10, 2]], self.dungeon_level)
        }
</code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>       item_chances = {
            'healing_potion': 35,
            <span class="new-text">'sword': from_dungeon_level([[5, 4]], self.dungeon_level),
            'shield': from_dungeon_level([[15, 8]], self.dungeon_level),</span>
            'lightning_scroll': from_dungeon_level([[25, 4]], self.dungeon_level),
            'fireball_scroll': from_dungeon_level([[25, 6]], self.dungeon_level),
            'confusion_scroll': from_dungeon_level([[10, 2]], self.dungeon_level)
        }</pre>

</div>

</div>


<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

   <div class="data-pane active" data-pane="diff">
   <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">               ...
                if item_choice == &#39;healing_potion&#39;:
                    item_component = Item(use_function=heal, amount=40)
                    item = Entity(x, y, &#39;!&#39;, libtcod.violet, &#39;Healing Potion&#39;, render_order=RenderOrder.ITEM,
                                  item=item_component)
<span style="color:#a6e22e">+               elif item_choice == &#39;sword&#39;:
</span><span style="color:#a6e22e">+                   equippable_component = Equippable(EquipmentSlots.MAIN_HAND, power_bonus=3)
</span><span style="color:#a6e22e">+                   item = Entity(x, y, &#39;/&#39;, libtcod.sky, &#39;Sword&#39;, equippable=equippable_component)
</span><span style="color:#a6e22e">+               elif item_choice == &#39;shield&#39;:
</span><span style="color:#a6e22e">+                   equippable_component = Equippable(EquipmentSlots.OFF_HAND, defense_bonus=1)
</span><span style="color:#a6e22e">+                   item = Entity(x, y, &#39;[&#39;, libtcod.darker_orange, &#39;Shield&#39;, equippable=equippable_component)
</span><span style="color:#a6e22e"></span>                elif item_choice == &#39;fireball_scroll&#39;:
                    ...
</code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>               ...
                if item_choice == 'healing_potion':
                    item_component = Item(use_function=heal, amount=40)
                    item = Entity(x, y, '!', libtcod.violet, 'Healing Potion', render_order=RenderOrder.ITEM,
                                  item=item_component)
                <span class="new-text">elif item_choice == 'sword':
                    equippable_component = Equippable(EquipmentSlots.MAIN_HAND, power_bonus=3)
                    item = Entity(x, y, '/', libtcod.sky, 'Sword', equippable=equippable_component)
                elif item_choice == 'shield':
                    equippable_component = Equippable(EquipmentSlots.OFF_HAND, defense_bonus=1)
                    item = Entity(x, y, '[', libtcod.darker_orange, 'Shield', equippable=equippable_component)</span>
                elif item_choice == 'fireball_scroll':
                    ...</pre>

</div>

</div>


<p>Une chose qu&rsquo;on peut faire pour rendre le jeu plus intéressant est de donner
une arme de base au joueur. Rien de trop puissant, bien sûr, c&rsquo;est un
roguelike après tout. Modifions la fonction <code>get_game_variables</code> dans
<code>initialize_new_game.py</code> pour donne au joueur une dague au début de partie.</p>

<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

   <div class="data-pane active" data-pane="diff">
   <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">import tcod as libtcod

from components.equipment import Equipment
<span style="color:#a6e22e">+from components.equippable import Equippable
</span><span style="color:#a6e22e"></span>from components.fighter import Fighter
from components.inventory import Inventory
from components.level import Level

from entity import Entity

<span style="color:#a6e22e">+from equipment_slots import EquipmentSlots
</span><span style="color:#a6e22e"></span>
from game_messages import MessageLog
...

def get_game_variables(constants):
<span style="color:#f92672">-   fighter_component = Fighter(hp=100, defense=1, power=4)
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+   fighter_component = Fighter(hp=100, defense=1, power=2)
</span><span style="color:#a6e22e"></span>    inventory_component = Inventory(26)
    level_component = Level()
    equipment_component = Equipment()
    player = Entity(0, 0, &#39;@&#39;, libtcod.white, &#39;Player&#39;, blocks=True, render_order=RenderOrder.ACTOR,
                    fighter=fighter_component, inventory=inventory_component, level=level_component,
                    equipment=equipment_component)
    entities = [player]

<span style="color:#a6e22e">+   equippable_component = Equippable(EquipmentSlots.MAIN_HAND, power_bonus=2)
</span><span style="color:#a6e22e">+   dagger = Entity(0, 0, &#39;-&#39;, libtcod.sky, &#39;Dagger&#39;, equippable=equippable_component)
</span><span style="color:#a6e22e">+   player.inventory.add_item(dagger)
</span><span style="color:#a6e22e">+   player.equipment.toggle_equip(dagger)
</span><span style="color:#a6e22e"></span>
    game_map = GameMap(constants[&#39;map_width&#39;], constants[&#39;map_height&#39;])
    ...
</code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>import tcod as libtcod

from components.equipment import Equipment
<span class="new-text">from components.equippable import Equippable</span>
from components.fighter import Fighter
from components.inventory import Inventory
from components.level import Level

from entity import Entity

<span class="new-text">from equipment_slots import EquipmentSlots</span>

from game_messages import MessageLog
...

def get_game_variables(constants):
    <span class="crossed-out-text">fighter_component = Fighter(hp=100, defense=1, power=4)</span>
    <span class="new-text">fighter_component = Fighter(hp=100, defense=1, power=2)</span>
    inventory_component = Inventory(26)
    level_component = Level()
    equipment_component = Equipment()
    player = Entity(0, 0, '@', libtcod.white, 'Player', blocks=True, render_order=RenderOrder.ACTOR,
                    fighter=fighter_component, inventory=inventory_component, level=level_component,
                    equipment=equipment_component)
    entities = [player]

    <span class="new-text">equippable_component = Equippable(EquipmentSlots.MAIN_HAND, power_bonus=2)
    dagger = Entity(0, 0, '-', libtcod.sky, 'Dagger', equippable=equippable_component)
    player.inventory.add_item(dagger)
    player.equipment.toggle_equip(dagger)</span>

    game_map = GameMap(constants['map_width'], constants['map_height'])
    ...</pre>

</div>

</div>


<p>Remarquez qu&rsquo;on modifie aussi la puissance de départ. Nous ne voulons pas que
le joueur soit trop fort au départ !</p>

<p>Une dernière amélioration à ajouter : affichons dans l&rsquo;inventaire l&rsquo;équipement
porté par le joueur. Nous pouvons le faire en modifiant la fonction
<code>inventory_menu</code> dans <code>menus.py</code> pour vérifier si chaque objet est équipé ou
non. Nous devrons faire quelques chanchements dans les arguments de la fonction,
nous devons passer <code>player</code> et non plus seulement l&rsquo;inventaire. Modifiez la
fonction ainsi :</p>

<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

   <div class="data-pane active" data-pane="diff">
   <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff"><span style="color:#f92672">-def inventory_menu(con, header, inventory, inventory_width, screen_width, screen_height):
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+def inventory_menu(con, header, player, inventory_width, screen_width, screen_height):
</span><span style="color:#a6e22e"></span><span style="color:#f92672">-   if len(inventory.items) == 0:
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+   if len(player.inventory.items) == 0:
</span><span style="color:#a6e22e"></span>        options = [&#39;Inventory is empty.&#39;]
    else:
<span style="color:#f92672">-       options = [item.name for item in inventory.items]
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+       options = []
</span><span style="color:#a6e22e">+
</span><span style="color:#a6e22e">+       for item in player.inventory.items:
</span><span style="color:#a6e22e">+           if player.equipment.main_hand == item:
</span><span style="color:#a6e22e">+               options.append(&#39;{0} (on main hand)&#39;.format(item.name))
</span><span style="color:#a6e22e">+           elif player.equipment.off_hand == item:
</span><span style="color:#a6e22e">+               options.append(&#39;{0} (on off hand)&#39;.format(item.name))
</span><span style="color:#a6e22e">+           else:
</span><span style="color:#a6e22e">+               options.append(item.name)
</span><span style="color:#a6e22e"></span>
    menu(con, header, options, inventory_width, screen_width, screen_height)
</code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre><span class="crossed-out-text">def inventory_menu(con, header, inventory, inventory_width, screen_width, screen_height):</span>
<span class="new-text">def inventory_menu(con, header, player, inventory_width, screen_width, screen_height):</span>
    <span class="crossed-out-text">if len(inventory.items) == 0:</span>
    <span class="new-text">if len(player.inventory.items) == 0:</span>
        options = ['Inventory is empty.']
    else:
        <span class="crossed-out-text">options = [item.name for item in inventory.items]</span>
        <span class="new-text">options = []

        for item in player.inventory.items:
            if player.equipment.main_hand == item:
                options.append('{0} (on main hand)'.format(item.name))
            elif player.equipment.off_hand == item:
                options.append('{0} (on off hand)'.format(item.name))
            else:
                options.append(item.name)</span>

    menu(con, header, options, inventory_width, screen_width, screen_height)</pre>

</div>

</div>


<p>Parce que nous avons changé les arguments de cette fonction nous devons
adapter son appel dans <code>render_all</code>.</p>

<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

   <div class="data-pane active" data-pane="diff">
   <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">        ...
            inventory_title = &#39;Press the key next to an item to drop it, or Esc to cancel.\n&#39;

<span style="color:#f92672">-       inventory_menu(con, inventory_title, player.inventory, 50, screen_width, screen_height)
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+       inventory_menu(con, inventory_title, player, 50, screen_width, screen_height)
</span><span style="color:#a6e22e"></span>
    elif game_state == GameStates.LEVEL_UP:
        ...
</code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>
        ...
            inventory_title = 'Press the key next to an item to drop it, or Esc to cancel.\n'

        <span class="crossed-out-text">inventory_menu(con, inventory_title, player.inventory, 50, screen_width, screen_height)</span>
        <span class="new-text">inventory_menu(con, inventory_title, player, 50, screen_width, screen_height)</span>

    elif game_state == GameStates.LEVEL_UP:
        ...</pre>

</div>

</div>


<p>With that, we have a functional equipment system! This concludes the
main tutorial. If you&rsquo;re wanting more, feel free to check out the extras
section, which I&rsquo;ll try to update now and then with some new content.
Now go forth, and create the roguelike of your dreams!</p>

<p>Avec ça, nous avons un système d&rsquo;équiment qui fonctionne ! Cela conclut
le tutoriel principal. Si vous en voulez davantage, n&rsquo;hésitez pas à vérifier
les extras que j&rsquo;essayerai de mettre à jour de temps en temps.
Maintenant continuez sur votre lancée et créez le roguelike de vos rêves.</p>

<p>Si vous voulez voir le code actuel entièrement, [cliquez ici](<a href="https://github.com/TStand90/roguelike_tutorial_revised/tree/part-13">https://github.com/TStand90/roguelike_tutorial_revised/tree/part-13</a>.</p>

<script src="/js/codetabs.js"></script>


    

    


</article>



        </div>

        <aside class="col-12 col-lg-3 ml-auto blog-sidebar">
    
    
        <section>
    
        
    
        
    
</section>
    
</aside>

      </div>
    </div>
    

    
      







<footer class="blog-footer w-100">
    <nav class="navbar navbar-light bg-light">
        <p class="w-100 text-center">Dernière mise à jour le 24 juillet 2019</p>
        <p class="w-100 text-center"><a href="#">Back to top</a></p>
    </nav>
</footer>

    

    
    
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
  </body>
</html>
