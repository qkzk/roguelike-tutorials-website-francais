<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta property="og:title" content="Part 12 - Augmenter la difficulté" />
<meta property="og:description" content="Notre jeu ne ressemble plus vraiment à un Roguelike : il est bien trop facile ! Qui plus est la difficulté n&rsquo;augmente quand l&rsquo;on progresse. Nous allons y remédier dans ce chapitre en rendant les ennemis plus fort et en répartissant les ennemis et les objets à travers les niveaux de profondeur.
Avant de s&rsquo;attaquer à ça, nous allons résoudre un problème de design qui nous causera des soucis plus tard : notre fonction de choix aléatoire pour les monstres et les objets." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/tutoriels/tcod/part-12/" />
<meta property="article:published_time" content="2019-03-30T09:34:08-07:00"/>
<meta property="article:modified_time" content="2019-03-30T09:34:08-07:00"/>

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Part 12 - Augmenter la difficulté"/>
<meta name="twitter:description" content="Notre jeu ne ressemble plus vraiment à un Roguelike : il est bien trop facile ! Qui plus est la difficulté n&rsquo;augmente quand l&rsquo;on progresse. Nous allons y remédier dans ce chapitre en rendant les ennemis plus fort et en répartissant les ennemis et les objets à travers les niveaux de profondeur.
Avant de s&rsquo;attaquer à ça, nous allons résoudre un problème de design qui nous causera des soucis plus tard : notre fonction de choix aléatoire pour les monstres et les objets."/>



    <link rel="canonical" href="/tutoriels/tcod/part-12/">

    <title>
      
        Part 12 - Augmenter la difficulté | Tutoriel Roguelike
      
    </title>

    
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link href="/css/style.css" rel="stylesheet">

    

    

    
  </head>
  <body>
    
      

<header class="blog-header">
    <nav class="navbar navbar-expand-md navbar-dark bg-dark">
        <a class="navbar-brand" href="/">
            Tutoriel Roguelike
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false"
            aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-between" id="navbarNav">
            <ul class="navbar-nav">
                
                
                <li class="nav-item ">
                    
                        <a class="nav-link" href="/">Home</a>
                    
                </li>
                
                <li class="nav-item ">
                    
                        <a class="nav-link" href="/tutoriels/tcod/">Tutoriel TCOD</a>
                    
                </li>
                
                <li class="nav-item ">
                    
                        <a class="nav-link" href="/about/">A propos</a>
                    
                </li>
                
            </ul>
            
        </div>
    </nav>
</header>

    

    
    <div class="container">
      <div class="row">
        <div class="col-12 col-lg-8 blog-main">

          

<header>
    <h2 class="blog-post-title">
    <a class="text-dark" href="/tutoriels/tcod/part-12/">Part 12 - Augmenter la difficulté</a>
</h2>

    


<div class="blog-post-date text-secondary">
    
        <time datetime="2019-03-30">Mar 30, 2019</time>
    
    
</div>

    
    
    <hr>
</header>
<article class="blog-post">
    <p>Notre jeu ne ressemble plus vraiment à un Roguelike : il est bien trop facile !
Qui plus est la difficulté n&rsquo;augmente quand l&rsquo;on progresse. Nous allons
y remédier dans ce chapitre en rendant les ennemis plus fort et en répartissant
les ennemis et les objets à travers les niveaux de profondeur.</p>

<p>Avant de s&rsquo;attaquer à ça, nous allons résoudre un problème de design qui nous
causera des soucis plus tard : notre fonction de choix aléatoire pour les
monstres et les objets. Pour l&rsquo;instant on tire un entier entre 1 et 100 et
on vérifie si ce nombre est inférieur à une certaine &ldquo;chance&rdquo; pour un certain
objet. Cela convient pour un nombre limité d&rsquo;options mais vous voudrez
certainement ajouter plus de deux ennemis et plus de quatre objets.</p>

<p>Il est plus judicieux de tirer au sort en attribuant à chaque objet un &ldquo;poids&rdquo;
qui indique sa probabilité d&rsquo;apparaître. Nous pourrions les options et leurs
poids à une fonction qui en choisirait un aléatoirement et renverrait la
réponse.</p>

<p>Créez un fichier appelé <code>random_utils.py</code> et ajoutez-y :</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3"><span style="color:#f92672">from</span> random <span style="color:#66d9ef">import</span> randint


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">random_choice_index</span>(chances):
    random_chance <span style="color:#f92672">=</span> randint(<span style="color:#ae81ff">1</span>, sum(chances))

    running_sum <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    choice <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    <span style="color:#66d9ef">for</span> w <span style="color:#f92672">in</span> chances:
        running_sum <span style="color:#f92672">+=</span> w

        <span style="color:#66d9ef">if</span> random_chance <span style="color:#f92672">&lt;=</span> running_sum:
            <span style="color:#66d9ef">return</span> choice
        choice <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">random_choice_from_dict</span>(choice_dict):
    choices <span style="color:#f92672">=</span> list(choice_dict<span style="color:#f92672">.</span>keys())
    chances <span style="color:#f92672">=</span> list(choice_dict<span style="color:#f92672">.</span>values())

    <span style="color:#66d9ef">return</span> choices[random_choice_index(chances)]</code></pre></div>

<p>Mettons cette nouvelle fonction en action. Ouvrez <code>game_map.py</code> et
modifiez ainsi :</p>

<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

   <div class="data-pane active" data-pane="diff">
   <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">...
from map_objects.tile import Tile

<span style="color:#a6e22e">+from random_utils import random_choice_from_dict
</span><span style="color:#a6e22e"></span>
from render_functions import RenderOrder
...
</code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>...
from map_objects.tile import Tile

<span class="new-text">from random_utils import random_choice_from_dict</span>

from render_functions import RenderOrder
...</pre>

</div>

</div>


<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

   <div class="data-pane active" data-pane="diff">
   <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">    def place_entities(self, room, entities, max_monsters_per_room, max_items_per_room):
        number_of_monsters = randint(0, max_monsters_per_room)
        number_of_items = randint(0, max_items_per_room)

<span style="color:#a6e22e">+       monster_chances = {&#39;orc&#39;: 80, &#39;troll&#39;: 20}
</span><span style="color:#a6e22e">+       item_chances = {&#39;healing_potion&#39;: 70, &#39;lightning_scroll&#39;: 10, &#39;fireball_scroll&#39;: 10, &#39;confusion_scroll&#39;: 10}
</span><span style="color:#a6e22e"></span>
        for i in range(number_of_monsters):
            x = randint(room.x1 + 1, room.x2 - 1)
            y = randint(room.y1 + 1, room.y2 - 1)

            if not any([entity for entity in entities if entity.x == x and entity.y == y]):
<span style="color:#a6e22e">+               monster_choice = random_choice_from_dict(monster_chances)
</span><span style="color:#a6e22e"></span>
<span style="color:#f92672">-               if randint(0, 100) &lt; 80:
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+               if monster_choice == &#39;orc&#39;:
</span><span style="color:#a6e22e"></span>                    fighter_component = Fighter(hp=10, defense=0, power=3, xp=35)
                    ai_component = BasicMonster()

                    monster = Entity(x, y, &#39;o&#39;, libtcod.desaturated_green, &#39;Orc&#39;, blocks=True,
                                     render_order=RenderOrder.ACTOR, fighter=fighter_component, ai=ai_component)
                else:
                    fighter_component = Fighter(hp=16, defense=1, power=4, xp=100)
                    ai_component = BasicMonster()

                    monster = Entity(x, y, &#39;T&#39;, libtcod.darker_green, &#39;Troll&#39;, blocks=True, fighter=fighter_component,
                                     render_order=RenderOrder.ACTOR, ai=ai_component)

                entities.append(monster)

        for i in range(number_of_items):
            x = randint(room.x1 + 1, room.x2 - 1)
            y = randint(room.y1 + 1, room.y2 - 1)

            if not any([entity for entity in entities if entity.x == x and entity.y == y]):
<span style="color:#f92672">-               item_chance = randint(0, 100)
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+               item_choice = random_choice_from_dict(item_chances)
</span><span style="color:#a6e22e"></span>
<span style="color:#f92672">-               if item_chance &lt; 70:
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+               if item_choice == &#39;healing_potion&#39;:
</span><span style="color:#a6e22e"></span>                    item_component = Item(use_function=heal, amount=4)
                    item = Entity(x, y, &#39;!&#39;, libtcod.violet, &#39;Healing Potion&#39;, render_order=RenderOrder.ITEM,
                                  item=item_component)
<span style="color:#f92672">-               elif item_chance &lt; 80:
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+               elif item_choice == &#39;fireball_scroll&#39;:
</span><span style="color:#a6e22e"></span>                    item_component = Item(use_function=cast_fireball, targeting=True, targeting_message=Message(
                        &#39;Left-click a target tile for the fireball, or right-click to cancel.&#39;, libtcod.light_cyan),
                                          damage=12, radius=3)
                    item = Entity(x, y, &#39;#&#39;, libtcod.red, &#39;Fireball Scroll&#39;, render_order=RenderOrder.ITEM,
                                  item=item_component)
<span style="color:#f92672">-               elif item_chance &lt; 90:
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+               elif item_choice == &#39;confusion_scroll&#39;:
</span><span style="color:#a6e22e"></span>                    item_component = Item(use_function=cast_confuse, targeting=True, targeting_message=Message(
                        &#39;Left-click an enemy to confuse it, or right-click to cancel.&#39;, libtcod.light_cyan))
                    item = Entity(x, y, &#39;#&#39;, libtcod.light_pink, &#39;Confusion Scroll&#39;, render_order=RenderOrder.ITEM,
                                  item=item_component)
                else:
                    item_component = Item(use_function=cast_lightning, damage=20, maximum_range=5)
                    item = Entity(x, y, &#39;#&#39;, libtcod.yellow, &#39;Lightning Scroll&#39;, render_order=RenderOrder.ITEM,
                                  item=item_component)

                entities.append(item)
</code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>    def place_entities(self, room, entities, max_monsters_per_room, max_items_per_room):
        number_of_monsters = randint(0, max_monsters_per_room)
        number_of_items = randint(0, max_items_per_room)

        <span class="new-text">monster_chances = {'orc': 80, 'troll': 20}
        item_chances = {'healing_potion': 70, 'lightning_scroll': 10, 'fireball_scroll': 10, 'confusion_scroll': 10}</span>

        for i in range(number_of_monsters):
            x = randint(room.x1 + 1, room.x2 - 1)
            y = randint(room.y1 + 1, room.y2 - 1)

            if not any([entity for entity in entities if entity.x == x and entity.y == y]):
                <span class="new-text">monster_choice = random_choice_from_dict(monster_chances)</span>

                <span class="crossed-out-text">if randint(0, 100) < 80:</span>
                <span class="new-text">if monster_choice == 'orc':</span>
                    fighter_component = Fighter(hp=10, defense=0, power=3, xp=35)
                    ai_component = BasicMonster()

                    monster = Entity(x, y, 'o', libtcod.desaturated_green, 'Orc', blocks=True,
                                     render_order=RenderOrder.ACTOR, fighter=fighter_component, ai=ai_component)
                else:
                    fighter_component = Fighter(hp=16, defense=1, power=4, xp=100)
                    ai_component = BasicMonster()

                    monster = Entity(x, y, 'T', libtcod.darker_green, 'Troll', blocks=True, fighter=fighter_component,
                                     render_order=RenderOrder.ACTOR, ai=ai_component)

                entities.append(monster)

        for i in range(number_of_items):
            x = randint(room.x1 + 1, room.x2 - 1)
            y = randint(room.y1 + 1, room.y2 - 1)

            if not any([entity for entity in entities if entity.x == x and entity.y == y]):
                <span class="crossed-out-text">item_chance = randint(0, 100)</span>
                <span class="new-text">item_choice = random_choice_from_dict(item_chances)</span>

                <span class="crossed-out-text">if item_chance < 70:</span>
                <span class="new-text">if item_choice == 'healing_potion':</span>
                    item_component = Item(use_function=heal, amount=4)
                    item = Entity(x, y, '!', libtcod.violet, 'Healing Potion', render_order=RenderOrder.ITEM,
                                  item=item_component)
                <span class="crossed-out-text">elif item_chance < 80:</span>
                <span class="new-text">elif item_choice == 'fireball_scroll':</span>
                    item_component = Item(use_function=cast_fireball, targeting=True, targeting_message=Message(
                        'Left-click a target tile for the fireball, or right-click to cancel.', libtcod.light_cyan),
                                          damage=12, radius=3)
                    item = Entity(x, y, '#', libtcod.red, 'Fireball Scroll', render_order=RenderOrder.ITEM,
                                  item=item_component)
                <span class="crossed-out-text">elif item_chance < 90:</span>
                <span class="new-text">elif item_choice == 'confusion_scroll':</span>
                    item_component = Item(use_function=cast_confuse, targeting=True, targeting_message=Message(
                        'Left-click an enemy to confuse it, or right-click to cancel.', libtcod.light_cyan))
                    item = Entity(x, y, '#', libtcod.light_pink, 'Confusion Scroll', render_order=RenderOrder.ITEM,
                                  item=item_component)
                else:
                    item_component = Item(use_function=cast_lightning, damage=20, maximum_range=5)
                    item = Entity(x, y, '#', libtcod.yellow, 'Lightning Scroll', render_order=RenderOrder.ITEM,
                                  item=item_component)

                entities.append(item)</pre>

</div>

</div>


<p>On attribue à chaque ennemi ou objet un poids et la sélection est effectuée par
notre nouvelle fonction. Remarquez que le cumul des poids est 100 mais cela
n&rsquo;est pas indispensable.</p>

<p>C&rsquo;est beaucoup plus extensible que notre solution précédente mais nous n&rsquo;avons
pas encore atteint notre objectif. Nous aimerions avoir des poids dépendant
du niveau de profondeur. Ainsi, plus on descend et plus on a de chances de
rencontrer des Trolls plutôt que des Orcs et plus on a de chance de trouver
des objets utiles plutôt que seulement des potions de soin.</p>

<p>Créons une nouvelle fonction qui prendra un intervalle de valeurs indiquant
quand une chose apparaît dans le donjon et avec quel poids.
La fonction renvoie le poids correspondant au niveau du donjon. Elle va
dans <code>random_utils.py</code> et ressemble à ça :</p>

<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

   <div class="data-pane active" data-pane="diff">
   <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">from random import randint


<span style="color:#a6e22e">+def from_dungeon_level(table, dungeon_level):
</span><span style="color:#a6e22e">+   for (value, level) in reversed(table):
</span><span style="color:#a6e22e">+       if dungeon_level &gt;= level:
</span><span style="color:#a6e22e">+           return value
</span><span style="color:#a6e22e">+
</span><span style="color:#a6e22e">+   return 0
</span><span style="color:#a6e22e"></span>

def random_choice_index(chances):
    ...
</code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>from random import randint


<span class="new-text">def from_dungeon_level(table, dungeon_level):
    for (value, level) in reversed(table):
        if dungeon_level >= level:
            return value

    return 0</span>


def random_choice_index(chances):
    ...</pre>

</div>

</div>


<p>Cela n&rsquo;a peut-être pas beaucoup de sens maintenant mais mettons la en action.
On peut retirer les variables <code>max_monsters_per_room</code> et <code>max_items_per_room</code>
qui sont maintenant déterminées par le niveau de profondeur et non plus passées
directement à la fonction.</p>

<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

   <div class="data-pane active" data-pane="diff">
   <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">...
from map_objects.tile import Tile

<span style="color:#f92672">-from random_utils import random_choice_from_dict
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+from random_utils import from_dungeon_level, random_choice_from_dict
</span><span style="color:#a6e22e"></span>
from render_functions import RenderOrder
</code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>...
from map_objects.tile import Tile

from random_utils import <span class="new-text">from_dungeon_level,</span> random_choice_from_dict

from render_functions import RenderOrder</pre>

</div>

</div>


<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

   <div class="data-pane active" data-pane="diff">
   <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff"><span style="color:#f92672">-   def place_entities(self, room, entities, max_monsters_per_room, max_items_per_room):
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+   def place_entities(self, room, entities):
</span><span style="color:#a6e22e">+       max_monsters_per_room = from_dungeon_level([[2, 1], [3, 4], [5, 6]], self.dungeon_level)
</span><span style="color:#a6e22e">+       max_items_per_room = from_dungeon_level([[1, 1], [2, 4]], self.dungeon_level)
</span><span style="color:#a6e22e"></span>
        number_of_monsters = randint(0, max_monsters_per_room)
        number_of_items = randint(0, max_items_per_room)

<span style="color:#f92672">-       monster_chances = {&#39;orc&#39;: 80, &#39;troll&#39;: 20}
</span><span style="color:#f92672">-       item_chances = {&#39;healing_potion&#39;: 70, &#39;lightning_scroll&#39;: 10, &#39;fireball_scroll&#39;: 10, &#39;confusion_scroll&#39;: 10}
</span><span style="color:#f92672"></span>
<span style="color:#a6e22e">+       monster_chances = {
</span><span style="color:#a6e22e">+           &#39;orc&#39;: 80,
</span><span style="color:#a6e22e">+           &#39;troll&#39;: from_dungeon_level([[15, 3], [30, 5], [60, 7]], self.dungeon_level)
</span><span style="color:#a6e22e">+       }
</span><span style="color:#a6e22e"></span>
<span style="color:#a6e22e">+       item_chances = {
</span><span style="color:#a6e22e">+           &#39;healing_potion&#39;: 35,
</span><span style="color:#a6e22e">+           &#39;lightning_scroll&#39;: from_dungeon_level([[25, 4]], self.dungeon_level),
</span><span style="color:#a6e22e">+           &#39;fireball_scroll&#39;: from_dungeon_level([[25, 6]], self.dungeon_level),
</span><span style="color:#a6e22e">+           &#39;confusion_scroll&#39;: from_dungeon_level([[10, 2]], self.dungeon_level)
</span><span style="color:#a6e22e">+       }
</span></code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>    <span class="crossed-out-text">def place_entities(self, room, entities, max_monsters_per_room, max_items_per_room):</span>
    <span class="new-text">def place_entities(self, room, entities):</span>
        <span class="new-text">max_monsters_per_room = from_dungeon_level([[2, 1], [3, 4], [5, 6]], self.dungeon_level)
        max_items_per_room = from_dungeon_level([[1, 1], [2, 4]], self.dungeon_level)</span>

        number_of_monsters = randint(0, max_monsters_per_room)
        number_of_items = randint(0, max_items_per_room)

        <span class="crossed-out-text">monster_chances = {'orc': 80, 'troll': 20}</span>
        <span class="crossed-out-text">item_chances = {'healing_potion': 70, 'lightning_scroll': 10, 'fireball_scroll': 10, 'confusion_scroll': 10}</span>

        <span class="new-text">monster_chances = {
            'orc': 80,
            'troll': from_dungeon_level([[15, 3], [30, 5], [60, 7]], self.dungeon_level)
        }</span>

        <span class="new-text">item_chances = {
            'healing_potion': 35,
            'lightning_scroll': from_dungeon_level([[25, 4]], self.dungeon_level),
            'fireball_scroll': from_dungeon_level([[25, 6]], self.dungeon_level),
            'confusion_scroll': from_dungeon_level([[10, 2]], self.dungeon_level)
        }</span></pre>

</div>

</div>


<p>Nous aurons aussi besoin de mettre à jour notre appel à <code>place_entities</code> depuis
<code>make_map</code>.</p>

<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

   <div class="data-pane active" data-pane="diff">
   <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">                        ...
                        self.create_h_tunnel(prev_x, new_x, new_y)

<span style="color:#f92672">-               self.place_entities(new_room, entities, max_monsters_per_room, max_items_per_room)
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+               self.place_entities(new_room, entities)
</span><span style="color:#a6e22e"></span>
                rooms.append(new_room)
                ...
</code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>                        ...
                        self.create_h_tunnel(prev_x, new_x, new_y)

                <span class="crossed-out-text">self.place_entities(new_room, entities, max_monsters_per_room, max_items_per_room)</span>
                <span class="new-text">self.place_entities(new_room, entities)</span>

                rooms.append(new_room)
                ...</pre>

</div>

</div>


<p>Parce que nous avons retiré <code>max_monsters_per_room</code> et <code>max_items_per_room</code> de
l&rsquo;appel de la fonction, nous pouvons aussi les retirer de la définition de
<code>make_map</code>.</p>

<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

   <div class="data-pane active" data-pane="diff">
   <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff"><span style="color:#f92672">-   def make_map(self, max_rooms, room_min_size, room_max_size, map_width, map_height, player, entities,
</span><span style="color:#f92672">-                max_monsters_per_room, max_items_per_room):
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+   def make_map(self, max_rooms, room_min_size, room_max_size, map_width, map_height, player, entities):
</span></code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>
    <span class="crossed-out-text">def make_map(self, max_rooms, room_min_size, room_max_size, map_width, map_height, player, entities,</span>
                 <span class="crossed-out-text">max_monsters_per_room, max_items_per_room):</span>
    <span class="new-text">def make_map(self, max_rooms, room_min_size, room_max_size, map_width, map_height, player, entities):</span></pre>

</div>

</div>


<p>Nous devrions aussi retirer ces variables des appels de <code>make_map</code> dans
<code>initialize_new_game.py</code>&hellip;</p>

<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

   <div class="data-pane active" data-pane="diff">
   <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff"><span style="color:#f92672">-   game_map.make_map(constants[&#39;max_rooms&#39;], constants[&#39;room_min_size&#39;], constants[&#39;room_max_size&#39;],
</span><span style="color:#f92672">-                     constants[&#39;map_width&#39;], constants[&#39;map_height&#39;], player, entities,
</span><span style="color:#f92672">-                     constants[&#39;max_monsters_per_room&#39;], constants[&#39;max_items_per_room&#39;])
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+   game_map.make_map(constants[&#39;max_rooms&#39;], constants[&#39;room_min_size&#39;], constants[&#39;room_max_size&#39;],
</span><span style="color:#a6e22e">+                     constants[&#39;map_width&#39;], constants[&#39;map_height&#39;], player, entities)
</span></code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>    <span class="crossed-out-text">game_map.make_map(constants['max_rooms'], constants['room_min_size'], constants['room_max_size'],</span>
                      <span class="crossed-out-text">constants['map_width'], constants['map_height'], player, entities,</span>
                      <span class="crossed-out-text">constants['max_monsters_per_room'], constants['max_items_per_room'])</span>
    <span class="new-text">game_map.make_map(constants['max_rooms'], constants['room_min_size'], constants['room_max_size'],
                      constants['map_width'], constants['map_height'], player, entities)</span></pre>

</div>

</div>


<p>&hellip; and in <code>next_floor</code> (in
<code>game_map.py</code>):</p>

<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

   <div class="data-pane active" data-pane="diff">
   <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff"><span style="color:#f92672">-       self.make_map(constants[&#39;max_rooms&#39;], constants[&#39;room_min_size&#39;], constants[&#39;room_max_size&#39;],
</span><span style="color:#f92672">-                     constants[&#39;map_width&#39;], constants[&#39;map_height&#39;], player, entities,
</span><span style="color:#f92672">-                     constants[&#39;max_monsters_per_room&#39;], constants[&#39;max_items_per_room&#39;])
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+       self.make_map(constants[&#39;max_rooms&#39;], constants[&#39;room_min_size&#39;], constants[&#39;room_max_size&#39;],
</span><span style="color:#a6e22e">+                     constants[&#39;map_width&#39;], constants[&#39;map_height&#39;], player, entities)
</span></code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>        <span class="crossed-out-text">self.make_map(constants['max_rooms'], constants['room_min_size'], constants['room_max_size'],</span>
                      <span class="crossed-out-text">constants['map_width'], constants['map_height'], player, entities,</span>
                      <span class="crossed-out-text">constants['max_monsters_per_room'], constants['max_items_per_room'])</span>
        <span class="new-text">self.make_map(constants['max_rooms'], constants['room_min_size'], constants['room_max_size'],
                      constants['map_width'], constants['map_height'], player, entities)</span></pre>

</div>

</div>


<p>Notre nouveau donjon devient plus dangereux au fur et à mesure de notre
descente ! Le jeu reste très facile néanmoins aussi changeons ça en modifiant
les valeurs par défaut pour chaque composant de l&rsquo;entité <code>Fighter</code> notamment
le joueur lui même. Nous allons aussi modifier les valeurs des potions
de soin, du parchemin boule de feu et du parchemin d&rsquo;éclair.</p>

<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

   <div class="data-pane active" data-pane="diff">
   <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">def get_game_variables(constants):
<span style="color:#f92672">-   fighter_component = Fighter(hp=30, defense=2, power=5)
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+   fighter_component = Fighter(hp=100, defense=1, power=4)
</span><span style="color:#a6e22e"></span>    inventory_component = Inventory(26)
    ...
</code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>
def get_game_variables(constants):
    <span class="crossed-out-text">fighter_component = Fighter(hp=30, defense=2, power=5)</span>
    <span class="new-text">fighter_component = Fighter(hp=100, defense=1, power=4)</span>
    inventory_component = Inventory(26)
    ...</pre>

</div>

</div>


<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

   <div class="data-pane active" data-pane="diff">
   <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">                ...
                if monster_choice == &#39;orc&#39;:
<span style="color:#f92672">-                   fighter_component = Fighter(hp=10, defense=0, power=3, xp=35)
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+                   fighter_component = Fighter(hp=20, defense=0, power=4, xp=35)
</span><span style="color:#a6e22e"></span>                    ai_component = BasicMonster()

                    monster = Entity(x, y, &#39;o&#39;, libtcod.desaturated_green, &#39;Orc&#39;, blocks=True,
                                     render_order=RenderOrder.ACTOR, fighter=fighter_component, ai=ai_component)
                else:
<span style="color:#f92672">-                   fighter_component = Fighter(hp=16, defense=1, power=4, xp=100)
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+                   fighter_component = Fighter(hp=30, defense=2, power=8, xp=100)
</span><span style="color:#a6e22e"></span>                    ai_component = BasicMonster()

                    monster = Entity(x, y, &#39;T&#39;, libtcod.darker_green, &#39;Troll&#39;, blocks=True, fighter=fighter_component,
                                     render_order=RenderOrder.ACTOR, ai=ai_component)
                ...
</code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>                ...
                if monster_choice == 'orc':
                    <span class="crossed-out-text">fighter_component = Fighter(hp=10, defense=0, power=3, xp=35)</span>
                    <span class="new-text">fighter_component = Fighter(hp=20, defense=0, power=4, xp=35)</span>
                    ai_component = BasicMonster()

                    monster = Entity(x, y, 'o', libtcod.desaturated_green, 'Orc', blocks=True,
                                     render_order=RenderOrder.ACTOR, fighter=fighter_component, ai=ai_component)
                else:
                    <span class="crossed-out-text">fighter_component = Fighter(hp=16, defense=1, power=4, xp=100)</span>
                    <span class="new-text">fighter_component = Fighter(hp=30, defense=2, power=8, xp=100)</span>
                    ai_component = BasicMonster()

                    monster = Entity(x, y, 'T', libtcod.darker_green, 'Troll', blocks=True, fighter=fighter_component,
                                     render_order=RenderOrder.ACTOR, ai=ai_component)
                ...</pre>

</div>

</div>


<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

   <div class="data-pane active" data-pane="diff">
   <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">            ...
            if not any([entity for entity in entities if entity.x == x and entity.y == y]):
                item_choice = random_choice_from_dict(item_chances)

                if item_choice == &#39;healing_potion&#39;:
<span style="color:#f92672">-                   item_component = Item(use_function=heal, amount=4)
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+                   item_component = Item(use_function=heal, amount=40)
</span><span style="color:#a6e22e"></span>                    item = Entity(x, y, &#39;!&#39;, libtcod.violet, &#39;Healing Potion&#39;, render_order=RenderOrder.ITEM,
                                  item=item_component)
                elif item_choice == &#39;fireball_scroll&#39;:
<span style="color:#f92672">-                   item_component = Item(use_function=cast_fireball, targeting=True, targeting_message=Message(
</span><span style="color:#f92672">-                       &#39;Left-click a target tile for the fireball, or right-click to cancel.&#39;, libtcod.light_cyan),
</span><span style="color:#f92672">-                                         damage=12, radius=3)
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+                   item_component = Item(use_function=cast_fireball, targeting=True, targeting_message=Message(
</span><span style="color:#a6e22e">+                       &#39;Left-click a target tile for the fireball, or right-click to cancel.&#39;, libtcod.light_cyan),
</span><span style="color:#a6e22e">+                                         damage=25, radius=3)
</span><span style="color:#a6e22e"></span>                    item = Entity(x, y, &#39;#&#39;, libtcod.red, &#39;Fireball Scroll&#39;, render_order=RenderOrder.ITEM,
                                  item=item_component)
                elif item_choice == &#39;confusion_scroll&#39;:
                    item_component = Item(use_function=cast_confuse, targeting=True, targeting_message=Message(
                        &#39;Left-click an enemy to confuse it, or right-click to cancel.&#39;, libtcod.light_cyan))
                    item = Entity(x, y, &#39;#&#39;, libtcod.light_pink, &#39;Confusion Scroll&#39;, render_order=RenderOrder.ITEM,
                                  item=item_component)
                else:
<span style="color:#f92672">-                   item_component = Item(use_function=cast_lightning, damage=20, maximum_range=5)
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+                   item_component = Item(use_function=cast_lightning, damage=40, maximum_range=5)
</span><span style="color:#a6e22e"></span>                    item = Entity(x, y, &#39;#&#39;, libtcod.yellow, &#39;Lightning Scroll&#39;, render_order=RenderOrder.ITEM,
                                  item=item_component)
                ...
</code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>            ...
            if not any([entity for entity in entities if entity.x == x and entity.y == y]):
                item_choice = random_choice_from_dict(item_chances)

                if item_choice == 'healing_potion':
                    <span class="crossed-out-text">item_component = Item(use_function=heal, amount=4)</span>
                    <span class="new-text">item_component = Item(use_function=heal, amount=40)</span>
                    item = Entity(x, y, '!', libtcod.violet, 'Healing Potion', render_order=RenderOrder.ITEM,
                                  item=item_component)
                elif item_choice == 'fireball_scroll':
                    <span class="crossed-out-text">item_component = Item(use_function=cast_fireball, targeting=True, targeting_message=Message(</span>
                        <span class="crossed-out-text">'Left-click a target tile for the fireball, or right-click to cancel.', libtcod.light_cyan),</span>
                                          <span class="crossed-out-text">damage=12, radius=3)</span>
                    <span class="new-text">item_component = Item(use_function=cast_fireball, targeting=True, targeting_message=Message(
                        'Left-click a target tile for the fireball, or right-click to cancel.', libtcod.light_cyan),
                                          damage=25, radius=3)</span>
                    item = Entity(x, y, '#', libtcod.red, 'Fireball Scroll', render_order=RenderOrder.ITEM,
                                  item=item_component)
                elif item_choice == 'confusion_scroll':
                    item_component = Item(use_function=cast_confuse, targeting=True, targeting_message=Message(
                        'Left-click an enemy to confuse it, or right-click to cancel.', libtcod.light_cyan))
                    item = Entity(x, y, '#', libtcod.light_pink, 'Confusion Scroll', render_order=RenderOrder.ITEM,
                                  item=item_component)
                else:
                    <span class="crossed-out-text">item_component = Item(use_function=cast_lightning, damage=20, maximum_range=5)</span>
                    <span class="new-text">item_component = Item(use_function=cast_lightning, damage=40, maximum_range=5)</span>
                    item = Entity(x, y, '#', libtcod.yellow, 'Lightning Scroll', render_order=RenderOrder.ITEM,
                                  item=item_component)
                ...</pre>

</div>

</div>


<p>Et voilà pour aujourd&rsquo;hui. La prochaine partie sera la dernière, nous y sommes
presque.</p>

<p>Si vous voulez voir le code actuel entièrement, [cliquez ici](<a href="https://github.com/TStand90/roguelike_tutorial_revised/tree/part-12">https://github.com/TStand90/roguelike_tutorial_revised/tree/part-12</a>.</p>

<p><a href="/tutorials/tcod/part-13">Cliquez ici pour vous rendre à la partie suivante de ce tutoriel.</a></p>

<script src="/js/codetabs.js"></script>


    

    


</article>



        </div>

        <aside class="col-12 col-lg-3 ml-auto blog-sidebar">
    
    
        <section>
    
        
    
        
    
</section>
    
</aside>

      </div>
    </div>
    

    
      







<footer class="blog-footer w-100">
    <nav class="navbar navbar-light bg-light">
        <p class="w-100 text-center">Dernière mise à jour le 24 juillet 2019</p>
        <p class="w-100 text-center"><a href="#">Back to top</a></p>
    </nav>
</footer>

    

    
    
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
  </body>
</html>
